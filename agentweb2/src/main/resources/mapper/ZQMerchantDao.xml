<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.eeepay.framework.dao.ZQMerchantDao" >

    <select id="getZQAcqId" resultType="long">
        SELECT id FROM acq_org WHERE acq_enname = #{saleName} LIMIT 1
    </select>
    
    <select id="selectByMerMbpAcq" resultType="cn.eeepay.framework.model.ZQMerchantInfo">
        select id,sync_status,report_status from zq_merchant_info 
        where merchant_no = #{merNo} and mbp_id = #{mbpId} and channel_code = #{acqEnname} order by create_time desc limit 1
    </select>
    <select id="queryZQMerchantInfo" resultType="cn.eeepay.framework.model.ZQMerchantInfo">
        SELECT zmi.unionpay_mer_no,mbp.id as bp_id,mi.merchant_no ,
            zmi.sync_status,zmi.sync_remark,mi.mobilephone,
            mi.merchant_name,zmi.create_time
        FROM zq_merchant_info zmi
        JOIN merchant_info mi ON mi.merchant_no = zmi.merchant_no
        LEFT JOIN merchant_business_product mbp ON mbp.id = zmi.mbp_id
        <where>
            zmi.channel_code = #{saleName}
            <if test="info != null">
                <if test="info.mobilephone != null and info.mobilephone != ''">
                    AND mi.mobilephone = #{info.mobilephone}
                </if>
                <if test="info.unionpayMerNo != null and info.unionpayMerNo != ''">
                    AND zmi.unionpay_mer_no = #{info.unionpayMerNo}
                </if>
                <if test="info.bpId != null and info.bpId != '' ">
                    AND mbp.id = #{info.bpId}
                </if>
                <if test="info.merchantNo != null and info.merchantNo != '' ">
                    AND (mi.merchant_no = #{info.merchantNo} or
                      POSITION(#{info.merchantNo} in mi.merchant_name) >= 1)
                </if>
                <if test="info.syncStatus != null and info.syncStatus != '' ">
                    AND zmi.sync_status = #{info.syncStatus}
                </if>
                <if test="info.idCardName != null and info.idCardName != '' ">
                    and mi.lawyer = #{info.idCardName}
                </if>
                <if test="info.idCardNo != null and info.idCardNo != '' ">
                    and mi.id_card_no = #{info.idCardNo}
                </if>
                <if test="info.terminalId != null and info.terminalId != '' ">
                    and zmi.terminal_no = #{info.terminalId}
                </if>
                <if test="info.startCreateTime != null and info.startCreateTime != '' ">
                    AND zmi.create_time &gt;= #{info.startCreateTime}
                </if>
                <if test="info.endCreateTime != null and info.endCreateTime != '' ">
                    AND zmi.create_time &lt;= #{info.endCreateTime}
                </if>
            </if>
        </where>
    </select>

    <select id="queryZQTransOrder" resultType="cn.eeepay.framework.model.ZQTransOrderInfo">
        SELECT mi.merchant_name,mi.mobilephone,mi.merchant_no,
            zmi.unionpay_mer_no,cto.account_no,cto.trans_amount,
            cto.trans_type,cto.trans_status,cto.pay_method,
            '${saleName}' AS channelCode,cto.order_no,cto.trans_time
        FROM collective_trans_order cto
        JOIN merchant_info mi ON mi.merchant_no = cto.merchant_no
        JOIN zq_merchant_info zmi ON zmi.merchant_no = mi.merchant_no AND zmi.mbp_id = cto.mbp_id
        <where>
            cto.acq_org_id = #{zqAcqId}
            AND  zmi.sync_status = '1'
            AND zmi.channel_code = #{saleName}
            <if test="info != null">
                <if test="info.mobilephone != null and info.mobilephone != ''">
                    AND mi.mobilephone = #{info.mobilephone}
                </if>
                <if test="info.unionpayMerNo != null and info.unionpayMerNo != ''">
                    AND zmi.unionpay_mer_no = #{info.unionpayMerNo}
                </if>
                <if test="info.bpId != null and info.bpId != ''">
                    AND zmi.mbp_id = #{info.bpId}
                </if>
                <if test="info.merchantName != null and info.merchantName != ''">
                    AND (mi.merchant_no = #{info.merchantName} OR POSITION(#{info.merchantName} IN mi.merchant_name) >= 1)
                </if>
                <if test="info.terminalId != null and info.terminalId != '' ">
                    AND zmi.terminal_no = #{info.terminalId}
                </if>
                <if test="info.accountNo != null and info.accountNo != ''">
                    AND cto.account_no = #{info.accountNo}
                </if>
                <if test="info.accountName != null and info.accountName != ''">
                    AND mi.lawyer = #{info.accountName}
                </if>
                <if test="info.idCardNo != null and info.idCardNo != ''">
                    AND mi.id_card_no = #{info.idCardNo}
                </if>
                <if test="info.transType != null and info.transType != ''">
                    AND cto.trans_type = #{info.transType}
                </if>
                <if test="info.transStatus != null and info.transStatus != ''">
                    AND cto.trans_status = #{info.transStatus}
                </if>
                <if test="info.startTransTime != null and info.startTransTime != ''">
                    AND cto.trans_time &gt;= #{info.startTransTime}
                </if>
                <if test="info.endTransTime != null and info.endTransTime != ''">
                    AND cto.trans_time &lt;= #{info.endTransTime}
                </if>
            </if>
        </where>
    </select>
</mapper>